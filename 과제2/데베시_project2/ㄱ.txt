#include <stdio.h>
#include <iostream>
#include <string>
#include <fstream>
#include "mysql.h"
using namespace std;

#pragma comment(lib, "libmysql.lib")

const char* host = "localhost"; // change if necessary
const char* user = "root";      // change if necessary
const char* pw = "20212023";       // change if necessary
const char* db = "project";

#define MAX_LEN			13000

int main(void) {
    MYSQL* connection = NULL;
    MYSQL conn;
    MYSQL_RES* sql_result;
    MYSQL_ROW sql_row;
    char line[MAX_LEN];
    int state = 0;

    if (mysql_init(&conn) == NULL)
        printf("mysql_init() error!");

    connection = mysql_real_connect(&conn, host, user, pw, db, 3306, (const char*)NULL, 0);   // the first NULL can be replaced to an existing db instance.
    if (connection == NULL) {
        printf("%d ERROR : %s\n", mysql_errno(&conn), mysql_error(&conn));
        return 1;
    }
    else {
        printf("Connection Succeed\n\n");

        if (mysql_select_db(&conn, db)) {
            printf("%d ERROR : %s\n", mysql_errno(&conn), mysql_error(&conn));
            return 1;
        }

        FILE* fp = fopen("CRUD.txt", "r");    // open CRUD file.
        if (fp == NULL) {
            printf("File open error!\n");
            return 1;
        }

        while (fgets(line, sizeof(line), fp) != NULL) {
            if (!strcmp(line, "$$$\n"))      // read lines from CRUD file, '$$$' separates CREATE / DELETE parts.
                break;
            mysql_query(connection, line);
        }
        fclose(fp);
    }

    while (1) {
        printf("---------- SELECT QUERY TYPES ----------\n\n");
        printf("\t1. TYPE 1\n");
        printf("\t2. TYPE 2\n");
        printf("\t3. TYPE 3\n");
        printf("\t4. TYPE 4\n");
        printf("\t5. TYPE 5\n");
        printf("\t6. TYPE 6\n");
        printf("\t7. TYPE 7\n");
        printf("\t0. QUIT\n\n");
        
        int input;
        printf("Query type(input only type number) : ");
        cin >> input;
        cin.ignore();

        if (input == 0) {
            break;
        }
        if (input == 1) {
            const char* query1 = ;

            while (true) {
                printf("---------- Subtypes in TYPE 1 ----------\n");
                printf("\t1. TYPE 1-1\n");
                int type1;
                cin >> type1;
                if (type1 == 1) {

                }
                else if (type1 == 0) {
                    break;
                }
                else {
                    printf("Invalid input\n");
                    continue;
                }
            }
        }
        else if (input == 2) {
            while (1) {
                printf("---------- Subtypes in TYPE 2 ----------\n");
                printf("\t1. TYPE 2-1\n");
                int type2;
                cin >> type2;
                if (type2 == 2) {

                }
                else if (type2 == 0) {
                    break;
                }
                else {
                    continue;
                    printf("Invalid input\n");
                }
            }
        }
        else if (input == 3) {
            while (1) {
                printf("---------- Subtypes in TYPE 3 ----------\n");
                printf("\t1. TYPE 3-1\n");
                printf("\t2. TYPE 3-2\n");
                int type3;
                cin >> type3;
                if (type3 == 1) {
                    int k;
                }
                else if (type3 == 2) {
                }
                else if (type3 == 0)
                    break;
                else {
                    printf("Invalid input\n");
                    continue;
                }
            }
        }
        else if (input == 4) {
            const char* query4 = "SELECT agent_name, AVG(sale_price), AVG(DATEDIFF(sale_date, list_date)) FROM sales WHERE YEAR(sale_date) = 2022 GROUP BY agent_name";
            while (1) {
                printf("---------- Subtypes in TYPE 4 ----------\n");
                printf("\t1. TYPE 4-1\n");
                printf("\t2. TYPE 4-2\n");
                int type4;
                cin >> type4;
                if (type4 == 1) {
                }
                else if (type4 == 2) {
                }
                else if (type4 == 0)
                    break;
                else {
                    printf("Invalid input\n");
                    continue;
                }
            }
        }
        else if (input == 5) {
            
        }
        else if (input == 6) {

        }
        else if (input == 7) {

        }
        else {
            printf("Invalid query type.\n");
        }
    }

    mysql_close(connection);
    return 0;
}